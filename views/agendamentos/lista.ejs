<div class="d-flex justify-content-between align-items-center mb-4">
    <h3><i class="bi bi-calendar-check"></i> Agendamentos</h3>
    <div class="btn-group">
        <button type="button" class="btn btn-primary" onclick="window.location.href='/agendamentos/novo'" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Cadastrar um novo agendamento (paciente, data/hora, profissional e tipo).">
            <i class="bi bi-plus-circle"></i> Novo Agendamento
        </button>
        <button type="button" class="btn btn-outline-secondary" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Exportar a lista atual de agendamentos.">
            <i class="bi bi-download"></i> Exportar
        </button>
    </div>
</div>

<!-- Filtros -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Status</label>
                <select class="form-select">
                    <option value="">Todos</option>
                    <option value="agendado">Agendado</option>
                    <option value="confirmado">Confirmado</option>
                    <option value="realizado">Realizado</option>
                    <option value="cancelado">Cancelado</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Profissional</label>
                <select class="form-select">
                    <option value="">Todos</option>
                    <option value="1">Dr. André Ballejo</option>
                    <option value="2">Dra. Ana Silva</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Período</label>
                <select class="form-select">
                    <option value="">Todos</option>
                    <option value="hoje">Hoje</option>
                    <option value="semana">Esta Semana</option>
                    <option value="mes">Este Mês</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">&nbsp;</label>
                <button type="button" class="btn btn-outline-secondary w-100">
                    <i class="bi bi-funnel"></i> Filtrar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Lista de Agendamentos -->
<div class="card">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="bi bi-list-ul"></i> Agendamentos
        </h5>
    </div>
    <div class="card-body">
        <% if (agendamentos && agendamentos.length > 0) { %>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Data/Hora</th>
                        <th>Paciente</th>
                        <th>Profissional</th>
                        <th>Tipo</th>
                        <th>Duração</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <% agendamentos.forEach(a => { %>
                    <tr>
                        <td>
                            <div><%= moment(a.data_hora).format('DD/MM/YYYY') %></div>
                            <small class="text-muted"><%= moment(a.data_hora).format('HH:mm') %></small>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2">
                                    <%= (a.paciente_nome || 'P').charAt(0).toUpperCase() %>
                                </div>
                                <div>
                                    <div class="fw-bold"><%= a.paciente_nome || 'Não informado' %></div>
                                    <small class="text-muted">CPF: <%= a.paciente_cpf || 'Não informado' %></small>
                                </div>
                            </div>
                        </td>
                        <td><%= a.profissional_nome || 'Não informado' %></td>
                        <td><span class="badge bg-primary"><%= a.tipo_consulta || 'Consulta' %></span></td>
                        <td><%= a.duracao_minutos || 30 %> min</td>
                        <td>
                            <% const st = (a.status || '').toLowerCase(); %>
                            <% const badge = st === 'confirmado' ? 'bg-success' : (st === 'cancelado' ? 'bg-danger' : (st === 'realizado' ? 'bg-secondary' : 'bg-warning')); %>
                            <span class="badge <%= badge %>"><%= a.status || 'agendado' %></span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" data-bs-placement="top" title="Editar este agendamento (indisponível nesta tela)." disabled>
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-success" data-bs-toggle="tooltip" data-bs-placement="top" title="Confirmar presença do paciente (indisponível nesta tela)." disabled>
                                    <i class="bi bi-check-circle"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-warning" data-bs-toggle="tooltip" data-bs-placement="top" title="Remarcar data/horário (indisponível nesta tela)." disabled>
                                    <i class="bi bi-calendar-event"></i>
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="tooltip" data-bs-placement="top" title="Cancelar este agendamento (indisponível nesta tela)." disabled>
                                    <i class="bi bi-x-circle"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <% } else { %>
            <div class="text-center py-5 text-muted">
        		<i class="bi bi-calendar-x fs-1"></i>
        		<h5 class="mt-3">Nenhum agendamento encontrado</h5>
        		<p class="mb-0">Crie um novo agendamento para aparecer aqui.</p>
        		<a href="/agendamentos/novo" class="btn btn-primary mt-3"><i class="bi bi-plus-circle"></i> Novo Agendamento</a>
        	</div>
        <% } %>
    </div>
</div>
